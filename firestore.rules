rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /*****************************************************************
     * PROVIDERS
     *
     * Rules for the `/providers` collection. Provider profiles are
     * public, but cannot be modified from the client-side.
     *****************************************************************/
    match /providers/{providerId} {
      /**
       * @description Provider profiles are public.
       * @allow (get) Anyone can view a provider's profile.
       * @allow (list) Anyone can list/query providers for search.
       */
      allow get, list: if true;

      /**
       * @description Client-side writes are disabled to protect data integrity.
       * All provider data must be managed through a separate, secure backend or
       * the Firebase Console.
       * @allow (create) Disabled for clients.
       * @allow (update) Disabled for clients.
       * @allow (delete) Disabled for clients.
       */
      allow write: if false;
    }

    /*****************************************************************
     * PROVIDER SUBMISSIONS
     *
     * Rules for the `/provider-submissions` collection. Anyone can
     * create a submission for review. Reads, updates and deletes
     * are disallowed for security.
     *****************************************************************/
    match /provider-submissions/{submissionId} {
      allow get, list: if false;
      allow update, delete: if false;

      /**
       * @description Anyone can submit a provider profile for review.
       * The submitted data must conform to the required fields of the
       * ProviderProfile schema to ensure basic data quality.
       */
      allow create: if request.resource.data.name is string
                    && request.resource.data.name.size() > 1
                    && request.resource.data.category is string
                    && request.resource.data.category.size() > 0
                    && request.resource.data.location is string
                    && request.resource.data.location.size() > 1;
    }
  }
}
